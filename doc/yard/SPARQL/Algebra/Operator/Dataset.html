<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: SPARQL::Algebra::Operator::Dataset
  
    &mdash; Web portal for RDF.rb.
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../';
  framesUrl = "../../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (D)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../SPARQL.html" title="SPARQL (module)">SPARQL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Algebra.html" title="SPARQL::Algebra (module)">Algebra</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">Operator</a></span></span>
     &raquo; 
    <span class="title">Dataset</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: SPARQL::Algebra::Operator::Dataset
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Binary.html" title="SPARQL::Algebra::Operator::Binary (class)">Binary</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></li>
          
            <li class="next"><span class='object_link'><a href="Binary.html" title="SPARQL::Algebra::Operator::Binary (class)">Binary</a></span></li>
          
            <li class="next">SPARQL::Algebra::Operator::Dataset</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="../Query.html" title="SPARQL::Algebra::Query (module)">Query</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">vendor/bundler/ruby/2.0.0/bundler/gems/sparql-10537155c1d7/lib/sparql/algebra/operator/dataset.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>The SPARQL GraphPattern <code>dataset</code> operator.</p>

<p>Instantiated with two operands, the first being an array of data source URIs,
either bare, indicating a default dataset, or expressed as an array <code>\[:named, \&lt;uri\&gt;\]</code>,
indicating that it represents a named data source.</p>

<p>This operator loads from the datasource, unless a graph named by
the datasource URI already exists in the repository.</p>

<p>The contained BGP queries are then performed against the specified
default and named graphs. Rather than using the actual default
graph of the dataset, queries against the default dataset are
run against named graphs matching a non-distinctive variable
and the results are filtered against those URIs included in
the default dataset.</p>

<p>Specifically, each BGP which is not part of a graph pattern
is replaced with a union of graph patterns with that BGP repeated
for each graph URI in the default dataset. This requires recursively
updating the operator.</p>

<p>Each graph pattern containing a variable graph name is replaced
by a filter on that variable such that the variable must match
only those named datasets specified.</p>

<p>If no default or no named graphs are specified, these queries
are eliminated.</p>

<p>Multiple default graphs union the information from a graph query
on each default datasource.</p>

<p>Multiple named graphs place a filter on all variables used
to identify those named graphs so that they are restricted
to come only from the specified set. Note that this requires
descending through expressions to find graph patterns using
variables and placing a filter on each identified variable.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Dataset with one default and one named data source</p>
</div></p>
      
      <pre class="example code"><code>
(prefix ((: &lt;http://example/&gt;))
  (dataset (&lt;data-g1.ttl&gt; (named &lt;data-g2.ttl&gt;))
    (union
      (bgp (triple ?s ?p ?o))
      (graph ?g (bgp (triple ?s ?p ?o))))))

is effectively re-written to the following:

(prefix ((: &lt;http://example/&gt;))
  (union
    (graph &lt;data-g1.ttl&gt; (bgp (triple ?s ?p ?o)))
    (filter (= ?g &lt;data-g2.ttl&gt;)
      (graph ?g (bgp (triple ?s ?p ?o))))))</code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Dataset with one default no named data sources</p>
</div></p>
      
      <pre class="example code"><code>
(prefix ((: &lt;http://example/&gt;))
  (dataset (&lt;data-g1.ttl&gt;)
    (union
      (bgp (triple ?s ?p ?o))
      (graph ?g (bgp (triple ?s ?p ?o))))))

is effectively re-written to the following:

(prefix ((: &lt;http://example/&gt;))
  (union
    (graph &lt;data-g1.ttl&gt; (bgp (triple ?s ?p ?o)))
    (bgp))</code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Dataset with two default data sources</p>
</div></p>
      
      <pre class="example code"><code>
(prefix ((: &lt;http://example/&gt;))
  (dataset (&lt;data-g1.ttl&gt; &lt;data-g1.ttl)
    (bgp (triple ?s ?p ?o))))

is effectively re-written to the following:

(prefix ((: &lt;http://example/&gt;))
  (union
    (graph &lt;data-g1.ttl&gt; (bgp (triple ?s ?p ?o)))
    (graph &lt;data-g2.ttl&gt; (bgp (triple ?s ?p ?o)))))</code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Dataset with two named data sources</p>
</div></p>
      
      <pre class="example code"><code>
(prefix ((: &lt;http://example/&gt;))
  (dataset ((named &lt;data-g1.ttl&gt;) (named &lt;data-g2.ttl&gt;))
    (graph ?g (bgp (triple ?s ?p ?o)))))

is effectively re-written to the following:

(prefix ((: &lt;http://example/&gt;))
  (filter ((= ?g &lt;data-g1.ttl&gt;) || (= ?g &lt;data-g2.ttl&gt;))
    (graph ?g (bgp (triple ?s ?p ?o))))))</code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Dataset with multiple named graphs</p>
</div></p>
      
      <pre class="example code"><code></code></pre>
    
  </div>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.w3.org/TR/rdf-sparql-query/#specifyingDataset" target="_parent" title="http://www.w3.org/TR/rdf-sparql-query/#specifyingDataset">http://www.w3.org/TR/rdf-sparql-query/#specifyingDataset</a></li>
    
  </ul>

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="NAME-constant" class="">NAME =
          
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span><span class='symbol'>:dataset</span><span class='rbracket'>]</span></pre></dd>
      
        <dt id="ACCEPTS-constant" class="">ACCEPTS =
          <div class="docstring">
  <div class="discussion">
    <p>Selected accept headers, from those available</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lparen'>(</span><span class='qwords_beg'>%w(
</span><span class='tstring_content'>text/turtle</span><span class='words_sep'>
</span><span class='tstring_content'>application/rdf+xml;q=0.8</span><span class='words_sep'>
</span><span class='tstring_content'>application/n-triples;q=0.4</span><span class='words_sep'>
</span><span class='tstring_content'>text/plain;q=0.1</span><span class='words_sep'>
</span><span class='tstring_end'>      )</span></span><span class='period'>.</span>
<span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_content_type'>content_type</span><span class='op'>|</span>
  <span class='comment'># Add other content types
</span>  <span class='const'>RDF</span><span class='op'>::</span><span class='const'>Format</span><span class='period'>.</span><span class='id identifier rubyid_content_types'>content_types</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_content_type'>content_type</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
<span class='kw'>end</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> */*;q=0.2</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="Binary.html" title="SPARQL::Algebra::Operator::Binary (class)">Binary</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Binary.html#ARITY-constant" title="SPARQL::Algebra::Operator::Binary::ARITY (constant)">Binary::ARITY</a></span></p>

  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Operator.html#ARITY-constant" title="SPARQL::Algebra::Operator::ARITY (constant)">ARITY</a></span></p>




  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes included from <span class='object_link'><a href="../Query.html" title="SPARQL::Algebra::Query (module)">Query</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Query.html#solutions-instance_method" title="SPARQL::Algebra::Query#solutions (method)">#solutions</a></span></p>

  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Operator.html#operands-instance_method" title="SPARQL::Algebra::Operator#operands (method)">#operands</a></span>, <span class='object_link'><a href="../Operator.html#options-instance_method" title="SPARQL::Algebra::Operator#options (method)">#options</a></span></p>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">- (RDF::Query::Solutions) <strong>execute</strong>(queryable, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Executes this query on the given <code>queryable</code> graph or repository.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#optimize-instance_method" title="#optimize (instance method)">- (Union, RDF::Query) <strong>optimize</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns an optimized version of this query.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Query.html" title="SPARQL::Algebra::Query (module)">Query</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Query.html#context%3D-instance_method" title="SPARQL::Algebra::Query#context= (method)">#context=</a></span>, <span class='object_link'><a href="../Query.html#each_solution-instance_method" title="SPARQL::Algebra::Query#each_solution (method)">#each_solution</a></span>, <span class='object_link'><a href="../Query.html#failed%3F-instance_method" title="SPARQL::Algebra::Query#failed? (method)">#failed?</a></span>, <span class='object_link'><a href="../Query.html#matched%3F-instance_method" title="SPARQL::Algebra::Query#matched? (method)">#matched?</a></span>, <span class='object_link'><a href="../Query.html#unshift-instance_method" title="SPARQL::Algebra::Query#unshift (method)">#unshift</a></span>, <span class='object_link'><a href="../Query.html#variables-instance_method" title="SPARQL::Algebra::Query#variables (method)">#variables</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Binary.html" title="SPARQL::Algebra::Operator::Binary (class)">Binary</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Binary.html#initialize-instance_method" title="SPARQL::Algebra::Operator::Binary#initialize (method)">#initialize</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Operator.html#arity-class_method" title="SPARQL::Algebra::Operator.arity (method)">arity</a></span>, <span class='object_link'><a href="../Operator.html#base_uri-instance_method" title="SPARQL::Algebra::Operator#base_uri (method)">#base_uri</a></span>, <span class='object_link'><a href="../Operator.html#base_uri-class_method" title="SPARQL::Algebra::Operator.base_uri (method)">base_uri</a></span>, <span class='object_link'><a href="../Operator.html#base_uri%3D-class_method" title="SPARQL::Algebra::Operator.base_uri= (method)">base_uri=</a></span>, <span class='object_link'><a href="../Operator.html#boolean-instance_method" title="SPARQL::Algebra::Operator#boolean (method)">#boolean</a></span>, <span class='object_link'><a href="../Operator.html#constant%3F-instance_method" title="SPARQL::Algebra::Operator#constant? (method)">#constant?</a></span>, <span class='object_link'><a href="../Operator.html#eql%3F-instance_method" title="SPARQL::Algebra::Operator#eql? (method)">#eql?</a></span>, <span class='object_link'><a href="../Operator.html#evaluatable%3F-instance_method" title="SPARQL::Algebra::Operator#evaluatable? (method)">#evaluatable?</a></span>, <span class='object_link'><a href="../Operator.html#evaluate-class_method" title="SPARQL::Algebra::Operator.evaluate (method)">evaluate</a></span>, <span class='object_link'><a href="../Operator.html#executable%3F-instance_method" title="SPARQL::Algebra::Operator#executable? (method)">#executable?</a></span>, <span class='object_link'><a href="../Operator.html#for-class_method" title="SPARQL::Algebra::Operator.for (method)">for</a></span>, <span class='object_link'><a href="../Operator.html#initialize-instance_method" title="SPARQL::Algebra::Operator#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="../Operator.html#inspect-instance_method" title="SPARQL::Algebra::Operator#inspect (method)">#inspect</a></span>, <span class='object_link'><a href="../Operator.html#operand-instance_method" title="SPARQL::Algebra::Operator#operand (method)">#operand</a></span>, <span class='object_link'><a href="../Operator.html#prefixes-class_method" title="SPARQL::Algebra::Operator.prefixes (method)">prefixes</a></span>, <span class='object_link'><a href="../Operator.html#prefixes-instance_method" title="SPARQL::Algebra::Operator#prefixes (method)">#prefixes</a></span>, <span class='object_link'><a href="../Operator.html#prefixes%3D-class_method" title="SPARQL::Algebra::Operator.prefixes= (method)">prefixes=</a></span>, <span class='object_link'><a href="../Operator.html#rewrite-instance_method" title="SPARQL::Algebra::Operator#rewrite (method)">#rewrite</a></span>, <span class='object_link'><a href="../Operator.html#to_binary-instance_method" title="SPARQL::Algebra::Operator#to_binary (method)">#to_binary</a></span>, <span class='object_link'><a href="../Operator.html#to_sxp-instance_method" title="SPARQL::Algebra::Operator#to_sxp (method)">#to_sxp</a></span>, <span class='object_link'><a href="../Operator.html#to_sxp_bin-instance_method" title="SPARQL::Algebra::Operator#to_sxp_bin (method)">#to_sxp_bin</a></span>, <span class='object_link'><a href="../Operator.html#variable%3F-instance_method" title="SPARQL::Algebra::Operator#variable? (method)">#variable?</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Expression.html" title="SPARQL::Algebra::Expression (module)">Expression</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Expression.html#cast-class_method" title="SPARQL::Algebra::Expression.cast (method)">cast</a></span>, <span class='object_link'><a href="../Expression.html#constant%3F-instance_method" title="SPARQL::Algebra::Expression#constant? (method)">#constant?</a></span>, <span class='object_link'><a href="../Expression.html#evaluate-instance_method" title="SPARQL::Algebra::Expression#evaluate (method)">#evaluate</a></span>, <span class='object_link'><a href="../Expression.html#for-class_method" title="SPARQL::Algebra::Expression.for (method)">for</a></span>, <span class='object_link'><a href="../Expression.html#new-class_method" title="SPARQL::Algebra::Expression.new (method)">new</a></span>, <span class='object_link'><a href="../Expression.html#open-class_method" title="SPARQL::Algebra::Expression.open (method)">open</a></span>, <span class='object_link'><a href="../Expression.html#parse-class_method" title="SPARQL::Algebra::Expression.parse (method)">parse</a></span>, <span class='object_link'><a href="../Expression.html#to_sxp_bin-instance_method" title="SPARQL::Algebra::Expression#to_sxp_bin (method)">#to_sxp_bin</a></span>, <span class='object_link'><a href="../Expression.html#variable%3F-instance_method" title="SPARQL::Algebra::Expression#variable? (method)">#variable?</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Evaluatable.html" title="SPARQL::Algebra::Evaluatable (module)">Evaluatable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Evaluatable.html#apply-instance_method" title="SPARQL::Algebra::Evaluatable#apply (method)">#apply</a></span>, <span class='object_link'><a href="../Evaluatable.html#evaluate-instance_method" title="SPARQL::Algebra::Evaluatable#evaluate (method)">#evaluate</a></span>, <span class='object_link'><a href="../Evaluatable.html#memoize-instance_method" title="SPARQL::Algebra::Evaluatable#memoize (method)">#memoize</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="Binary.html#initialize-instance_method" title="SPARQL::Algebra::Operator::Binary#initialize (method)">SPARQL::Algebra::Operator::Binary</a></span></p>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="execute-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../RDF/Query/Solutions.html" title="RDF::Query::Solutions (class)">RDF::Query::Solutions</a></span></tt>) <strong>execute</strong>(queryable, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Executes this query on the given <code>queryable</code> graph or repository.
Reads specified data sources into queryable. Named data sources
are added using a <em>context</em> of the data source URI.</p>

<p>Datasets are specified in operand(1), which is an array of default or named graph URIs.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>queryable</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../RDF/Queryable.html" title="RDF::Queryable (module)">RDF::Queryable</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the graph or repository to query</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>any additional keyword options</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../RDF/Query/Solutions.html" title="RDF::Query::Solutions (class)">RDF::Query::Solutions</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the resulting solution sequence</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.w3.org/TR/rdf-sparql-query/#sparqlAlgebra" target="_parent" title="http://www.w3.org/TR/rdf-sparql-query/#sparqlAlgebra">http://www.w3.org/TR/rdf-sparql-query/#sparqlAlgebra</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/2.0.0/bundler/gems/sparql-10537155c1d7/lib/sparql/algebra/operator/dataset.rb', line 136</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_queryable'>queryable</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Dataset</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_default_datasets'>default_datasets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_named_datasets'>named_datasets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_operand'>operand</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ds'>ds</span><span class='op'>|</span>
    <span class='id identifier rubyid_load_opts'>load_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='symbol'>:headers</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Accept</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'>ACCEPTS</span><span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_load_opts'>load_opts</span><span class='lbracket'>[</span><span class='symbol'>:debug</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:debug</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_ds'>ds</span>
    <span class='kw'>when</span> <span class='const'>Array</span>
      <span class='comment'># Format is (named &lt;uri&gt;), only need the URI part
</span>      <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span>
        <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_lexical'>lexical</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
        <span class='id identifier rubyid_u'>u</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
      <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_lexical'>lexical</span> <span class='op'>=</span> <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
      <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=&gt; named data source </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_named_datasets'>named_datasets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_uri'>uri</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_ds'>ds</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_ds'>ds</span>
      <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=&gt; default data source </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_default_datasets'>default_datasets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_uri'>uri</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_load_opts'>load_opts</span><span class='lbracket'>[</span><span class='symbol'>:context</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_load_opts'>load_opts</span><span class='lbracket'>[</span><span class='symbol'>:base_uri</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_queryable'>queryable</span><span class='period'>.</span><span class='id identifier rubyid_has_context?'>has_context?</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=&gt; load </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_queryable'>queryable</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='id identifier rubyid_load_opts'>load_opts</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rdf/nquads</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_queryable'>queryable</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='symbol'>:nquads</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>

  <span class='comment'># Create an aggregate based on queryable having just the bits we want
</span>  <span class='id identifier rubyid_aggregate'>aggregate</span> <span class='op'>=</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>AggregateRepo</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_queryable'>queryable</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_named_datasets'>named_datasets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> <span class='id identifier rubyid_aggregate'>aggregate</span><span class='period'>.</span><span class='id identifier rubyid_named'>named</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_queryable'>queryable</span><span class='period'>.</span><span class='id identifier rubyid_has_context?'>has_context?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_aggregate'>aggregate</span><span class='period'>.</span><span class='id identifier rubyid_default'>default</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_default_datasets'>default_datasets</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> <span class='id identifier rubyid_queryable'>queryable</span><span class='period'>.</span><span class='id identifier rubyid_has_context?'>has_context?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_executable'>executable</span> <span class='op'>=</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
  <span class='ivar'>@solutions</span> <span class='op'>=</span> <span class='id identifier rubyid_executable'>executable</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_aggregate'>aggregate</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='symbol'>:depth</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:depth</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="optimize-instance_method">
  
    - (<tt><span class='object_link'><a href="Union.html" title="SPARQL::Algebra::Operator::Union (class)">Union</a></span></tt>, <tt><span class='object_link'><a href="../../../RDF/Query.html" title="RDF::Query (class)">RDF::Query</a></span></tt>) <strong>optimize</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns an optimized version of this query.</p>

<p>If optimize operands, and if the first two operands are both Queries, replace
with the unique sum of the query elements</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Union.html" title="SPARQL::Algebra::Operator::Union (class)">Union</a></span></tt>, <tt><span class='object_link'><a href="../../../RDF/Query.html" title="RDF::Query (class)">RDF::Query</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p><code>self</code></p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/2.0.0/bundler/gems/sparql-10537155c1d7/lib/sparql/algebra/operator/dataset.rb', line 190</span>

<span class='kw'>def</span> <span class='id identifier rubyid_optimize'>optimize</span>
  <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_optimize'>optimize</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sun May 12 13:16:45 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.6.1 (ruby-2.0.0).
</div>

  </body>
</html>